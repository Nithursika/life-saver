CREATE TABLE user (
    userID INT AUTO_INCREMENT PRIMARY KEY,
    firstName VARCHAR(255) NOT NULL,
    lastName VARCHAR(255),
    phoneNumber VARCHAR(15) NOT NULL,
    NIC VARCHAR(20) UNIQUE, -- NIC field is unique
    address VARCHAR(255) NOT NULL,
    DOB DATE,  -- Date of Birth
    email VARCHAR(255) NOT NULL UNIQUE, -- email field is unique
    password VARCHAR(255) NOT NULL,
    preferredType INT,  -- ==============================================================================
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE hospital (
    hospitalID INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    location VARCHAR(255) NOT NULL,
    type ENUM('Government', 'Private') NOT NULL,
    noOfAmbulance INT NOT NULL,
    website VARCHAR(255),
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    contactNumber VARCHAR(15) NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE ambulance (
    ambulanceID INT AUTO_INCREMENT PRIMARY KEY,
    ambulanceNumber VARCHAR(20) NOT NULL UNIQUE, -- Ambulance_Number field is unique
    hospitalID INT NOT NULL,
    ambulanceLocation VARCHAR(255) NOT NULL,
    isAvailable BOOLEAN NOT NULL DEFAULT 0,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (hospitalID) REFERENCES hospital(hospitalID) on delete cascade on update cascade
);


CREATE TABLE driver (
    driverID INT AUTO_INCREMENT PRIMARY KEY,
    hospitalID int NOT NULL,
    firstName VARCHAR(255) NOT NULL,
    lastName VARCHAR(255),
    phoneNumber VARCHAR(15) NOT NULL,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    NIC VARCHAR(20) UNIQUE, -- NIC field is unique
    address VARCHAR(255) NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (hospitalID) REFERENCES hospital(hospitalID) on delete cascade on update cascade
);


CREATE TABLE emergency_request (
    requestID INT AUTO_INCREMENT PRIMARY KEY,
    userID INT NOT NULL,
    requestedTime DATETIME,
    status ENUM('Pending', 'Dispatched', 'Completed') NOT NULL,
    ambulanceID INT NOT NULL,
    userLocation VARCHAR(255) NOT NULL,
    hospitalID int,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (userID) REFERENCES user(userID) on delete cascade on update cascade,
    FOREIGN KEY (ambulanceID) REFERENCES ambulance(ambulanceID) on delete cascade on update cascade,
    FOREIGN KEY (hospitalID) REFERENCES hospital(hospitalID) on delete cascade on update cascade
);

CREATE TABLE feedback (
    feedbackID INT AUTO_INCREMENT PRIMARY KEY,
    userID INT,
    hospitalID INT,
    ambulanceID INT,
    feedbackMessage TEXT,
    feedbackType VARCHAR(50),
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (userID) REFERENCES user(userID) on delete cascade on update cascade,
    FOREIGN KEY (ambulanceID) REFERENCES ambulance(ambulanceID) on delete cascade on update cascade,
    FOREIGN KEY (hospitalID) REFERENCES hospital(hospitalID) on delete cascade on update cascade
);


CREATE TABLE ambulance_driver_connection (
    driverConnectionID INT AUTO_INCREMENT PRIMARY KEY,
    driverID INT NOT NULL,
    ambulanceID int NOT NULL,
    connectedTime DATETIME NOT NULL,
    disconnectedTime DATETIME NOT NULL,
    date date,
    workingHours time default "00:00:00",
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (driverID) REFERENCES driver(driverID) on delete cascade on update cascade,
    FOREIGN KEY (ambulanceID) REFERENCES ambulance(ambulanceID) on delete cascade on update cascade
);


CREATE TABLE user_ambulance_connection (
    connectionID INT AUTO_INCREMENT PRIMARY KEY,
    userID INT NOT NULL,
    ambulanceID INT NOT NULL,
    connectedTime DATETIME NOT NULL,
    disconnectedTime DATETIME NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (userID) REFERENCES user(userID) on delete cascade on update cascade,
    FOREIGN KEY (ambulanceID) REFERENCES ambulance(ambulanceID) on delete cascade on update cascade
);